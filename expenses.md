# Расходы на серверную часть (backend)

Приведена условная оценка расходов на оплату услуг хостинга севера и баз данных. Расходы на персонал, налоги, и т.д. - вне данного обзора.

## Основные статьи расходов

* Хостинг VPS сервера для работы приложения  
* SSL-сертификаты, аренда доменного имени  
* Хостинг базы данных. Может выполняться VPS сервером, но отдельный специализированный хостинг может быть более эффективным по причине оптимизации оборудования под задачи баз данных (много ОЗУ, быстрая дисковая подсистема, кэширующие кластеры, и т.д.)  
* Использование облачных API для выполнения специализированных задач (например, Google Maps)
* Оплата отправки e-mail и SMS для регистрации пользователя, восстановления пароля
* Лицензия разработчика для мобильных платформ

## Оценка расходов на хостинг (минимальные, уровень - hobby)

4 ARMv8, 2 GB за 3 фунта/месяц (UK)
https://www.scaleway.com/pricing/#anchor_arm

1 Core, 2GB за 3 евро/месяц (Germany, Finland)
https://www.hetzner.com/cloud-ru

Россия: 1 Core 1Gb - 400 руб/месяц
https://vscale.io/

Россия: 1 Core 1Gb - 220 руб/месяц
https://neoserver.ru/

Heroku: 512 Mb, Never Sleeps - $7/месяц. В общем случае, на Heroku осуществляется публикация приложения - это не полноценный VPS
https://www.heroku.com/pricing

AWS: 1 Core 1Gb t2.micro + DynamoDB - оценка в $27/месяц. Ключевое ограничение AWS - оплата постфактум. В случае ошибок конфигурирования сервисов, или ошибок в коде, можно получить "золотой чек" на оплату, который придётся оплатить.

Ключевая особенность VPS состоит в том, что это виртуальная машина (чаще всего на Linux), которую нужно администрировать. Соответственно, дополнительной статьём расхода, в этом случае будет являться администрирование сервера: настройка политики безопасности, обновление компонентов, backup-ирование данных, и т.д.

Чтобы минимизировать затраты можно использовать уже подготовленные VPS Images, например: [Parse Server](https://parseplatform.org/) на AWS.

## Альтернативы

Альтернативным решением является использование облачных платформ, предлагающих сотни различных специализированных сервисов, от баз данных до хранилищ данных (S3). Лидерами на международном рынке являются компании Amazon (AWS), Microsoft (Azure) и Google (Google Cloud Platform). Из "большой тройки" наиболее авторитетным является AWS, который предлагает не только самый большой набор сервисов, но и лучшие временные параметры, в частности - наименьшее время coldstart для Lambda/CloudFunctions.

### Популярные сервисы баз данных

База данных на mLab.com (куплен MongoDB): https://mlab.com/plans/pricing/ - SHARED - $15/Gb

База данных на MongoDB Atlas: https://www.mongodb.com/cloud/atlas/pricing - $9/месяц. Есть ограниченный бесплатный тариф.

[Firebase](https://firebase.google.com/pricing/). В 2020 году Google Cloud отказался от комфортного Flame Plan ($25/месяц) и запустил альтернативу **Blaze plan** - Pay as you go. Тарифицируется каждое действие, каждый запрос. Программирование должно быть исключительно аккуратным. Так, например, если на форме есть список товаров, список товаров в корзине, список текущих акций и список наиболее популярных товаров в группе, это может потребовать четырёх запросов и чек может быть кратно выше, чем его первоначальная оценка. Практический опыт использования изложен в статье *Mohammad Faisal*
[Costly Mistakes: Why We Had to Abandon Firebase](https://medium.com/javascript-in-plain-english/costly-mistakes-why-we-had-to-abandoned-firebase-b89930c10d92). Следует иметь ввиду, что Firebase содержит две базы данных: первоначальная - Realtime Database (была куплена) и собственная, новая - Firestore. На сайте Firebase есть конфигуратор для выбора того, или иного варианта.

[Статья Денис Гордиенко "Firebase — наша история исхода с сервиса"](https://vc.ru/services/229218-firebase-nasha-istoriya-ishoda-s-servisa) описывает дискреминационные действия в отношения бизнес-пользователей в России.

[Feathers.js](https://feathersjs.com/) - нужно исследовать, но вроде бы использует аутентификацию GitHub, что является бесплатным.

### Российские облачные платформы

Если ваш сервис должен соответствовать требованиям Федерального закона «О персональных данных» (ФЗ-152), то развертывание его в облаке от зарубежного поставщика потребует внедрения дополнительных технических решений, так как первичная обработка персональных данных (ПДн) должна происходить на территории Российской Федерации и в дальнейшем данные должны передаваться по защищенным каналам связи. Невыполнение требований о защите ПДн может привести к блокировке доступа к сервису Роскомнадзором. Т.к. в России нет центров обработки данных от Amazon, Microsoft и Google, следует рассматривать российские облачные сервисы.

[Yandex.Cloud](https://cloud.yandex.ru/). Ориентировочная цена слабого VPS ~300 руб/месяц. Хранилище на 100Gb ~120 руб/месяц. СУБД ~3500 руб/месяц.

[@Cloud](https://cloud.mail.ru/home/). vCPU = 100% за 740 руб/месяц. Облачная база данных ~1500 руб/месяц.

[SberCloud](https://sbercloud.ru/ru) - на базе серверных платформ Huawai. С ценами всё не очень понятно.

## Стоимость доменного имени

Стоимость доменного имени для зоны ".com" при покупке на AWS составляет $12, а для ".net" - $11. Дополнительные затраты на хостинг DNS (AWS Route53) составляют $0.50/месяц за одну зону хостинга. Цены [Zenon (Россия)](https://www.zenon.net/domains/): 280 руб/год за ".ru" и 882 руб/год за ".com".

## Стоимость системы рассылки электронной почты

Электронная почта используется для регистрации нового пользователя и в случае, если пользователь забыл пароль и хочет его восстановить. Отправкой почты занимаются сервисы, такие как [SendGrid](https://sendgrid.com/). Стоимость отправки 100 тысяч писем в месяц начинается с $15/месяц.

Подобный сервис необходимо использовать и для рассылки SMS с теми же целями.

Google Firebase содержит бесплатный сервис рассылки SMS для регистрации пользователей с ограничением 10000 SMS/месяц.

## Стоимость SSL-сертификатов

Публичный сертификат можно получить у специализированной компании сформировав запрос на выпуск сертификата CSR (**Certificate Signing Request**). В CSR указывается подробная информация о компании, для которой сгенерирован сертификат. Центр сертификации проводит проверку всех указанных данных (именно это составляет основной вклад в сумму оплаты услуги).

Существуют разные типы сертификатов, которые применяются к разным уровням проверки комапании и применимости к другим доменным именам. Например:

1. Обычные SSL-сертификаты только подтверждаю домен. Стоят $18-22/год
2. Wildcard-сертификаты требуются если используются суб.домены на сайте, например: zheka.rozhkov.ru. Стоимость от $190/год
3. Сертификат для сервера, на котором хостятся сайты для разных доменов – от $400/год

Стоимость SSL-сертификата **Thawte SSL WebServer** на [Zenon](https://www.zenon.net/ssl/) составляет 6384 руб/год.

Статья о "бесплатном" получении SSL сертификата на AWS: https://hackernoon.com/getting-a-free-ssl-certificate-on-aws-a-how-to-guide-6ef29e576d22.

Бесплатные сертификаты можно сгенерировать на [Let's Encrypt](https://letsencrypt.org/ru/getting-started/).

## Стоимость использования сервиса доступа к картам

https://developers.google.com/maps/billing/understanding-cost-of-use

Нужно вчитываться - услуг очень много и цена до $0.10/запрос. Из рекламы Google для коммерческих проектов: "*For most of our users, the $200 monthly credit is enough to support their needs. You can also set daily quotas to protect against unexpected increases*".

Бесплатный лимит вызовов Geocoder - 10.000/месяц.

По Yandex.Maps: https://tech.yandex.com/maps/commercial/

С дневным лимитом в 1000 запросов, стоимость - 120 тысяч рублей/год.

## Лицензия разработчика (возможность публикации в магазине приложений)

Google Play - $25/единожды  
Apple AppStore - $100/год

В случае использования React Native с [Expo](https://expo.io/), установка приложений может осуществляться через клиент Expo. Распространение приложений осуществляется посредством push-сервиса, но в бесплатном тарифе, сборка приложения осуществляется в "порядке общей очереди", т.е. сборка и публикация может занять несколько часов (даже десятки). Для того, чтобы попасть в начало очереди, следует использовать специализированный [тарифный план Priority](https://expo.io/developer-services), который стоит $29/месяц.

## Вспомогательные средства тестирования

Для тестирования доступа к приложению из разных географическим мест, можно воспользоваться VPN. Одним из наиболее удобных является [HideMyName](https://hidemy.name/ru/). Месяц стоит 470 руб, а год - 2280 руб.

<a name="DDNS"></a>
# DDNS - noip.com

Существует возможность переадрессовывать сетевой трафик на домашние компьютеры. В общем случае, провайдер доступа в интернет выделяет внешний IP-адрес клиенту. Чаще всего этот IP-адрес использует маршрутизатор, через который подключаются все остальные сетевые устройства в доме. Современные маршрутизаторы позволяет включить переадрессацию входящих http-запросов в локальную сеть (домашнюю) на конкретный IP-адрес и порт.

Включить переадрессацию можно на самом маршрутизаторе. Для этого нужно зайти под учёной записью администратора и настроить правило **port forwarding**, т.к. переадрессацию входящего запроса. Такая настройка в управляющей консоли администратора может храниться в разделе "NAT-переадрессация" -> "Виртуальные серверы".

Вторая часть задачи - обеспечить возможность переадрессации на динамически изменяемый IP-адрес маршрутизатора по некоторому символическому имени. Эту задачу можно решить  используя **Dynamic-DNS**.

Часто подобная схема применяется для маршрутизаторов домашних сетей. При загрузке, или изменении локального IP-адреса, маршрутизатор отправляет на специализированный сервис свой IP-адрес и credentials. Имя учётной записи на DDNS может использоваться для формирования символического имени компьютера/маршрутизатора, например: _sokoban.noip.com_. В случае, если сервис (DDNS) будет получать запросы на адрес связанный с учётной записью, он будет переадрессовывать запросы на IP-адрес этого компьютера (маршрутизатора).

Один из наиболее известных сервисов DDNS, у которого есть бесплатный тарифный план: https://www.noip.com/. Компания-разработчик опубликовала открытый протокол, который поддерживает множество сетевого оборудования (маршрутизаторы). Устанавливается клиент, который контролирует IP-адрес компьютера (маршрутизатора) и если он изменяется, то отправляет в сервис изменённый IP-адрес. Внешние пользователи используют зарегистрированное пользователем доменное имя (от 1 до 3 на пользователя - бесплатно) и переадресуют запрос на конечное устройство пользователя.

Можно применять к RPi 3/4. Искал: [How to Install No-IP on Raspberry Pi](https://www.slicethepi.co.uk/how-to-install-no-ip-on-raspberry-pi/)

Видео-инструкция [Fireship: Raspberry Pi versus AWS // How to host your website on the RPi4](https://www.youtube.com/watch?v=QdHvS0D1zAI)
